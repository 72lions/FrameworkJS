<!DOCTYPE HTML>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <title>Testing FrameworkJS</title>
    </head>
    <body>
        <script type="text/javascript" src="../src/json2.js"></script>
        <script type="text/javascript" src="../src/frameworkjs.js"></script>
        <script type="text/javascript" src="../src/publisher.js"></script>
        <script type="text/javascript" src="../src/ajax.js"></script>
        <script type="text/javascript" src="../src/service.js"></script>
        <script type="text/javascript" src="../src/utils.js"></script>
        <script type="text/javascript" src="../src/eventtarget.js"></script>
        <script type="text/javascript" src="../src/controller.js"></script>
        <script type="text/javascript" src="../src/view.js"></script>
        <script type="text/javascript" src="../src/model.js"></script>
        <script type="text/javascript">

            var  gridController1, gridView1, gridModel1, gridService1;
            var onTest, onTest2;
            var GridController, GridModel, GridView, GridService;

            /*
            ------------------------------------
            EXTENDING THE BASE CONTROLLER CLASS
            ------------------------------------
            */

            GridController =  FrameworkJS.extend(function() {
                // Overwritting the properties
                this.name = 'GridController';

                this.addListeners = function() {
                    // Listen to the a change of a specific model property
                    this.getModel().bind('change:prop1', onProperty1Changed, this);
                }

                var onProperty1Changed = function (event) {
                    console.log('Property 1 has changed. We got an event type of', event.type, 'and with value', event.value);
                };

            }, FrameworkJS.Controller, 'Controller.Grid');

            /*
            ------------------------------------
            EXTENDING THE BASE MODEL CLASS
            ------------------------------------
            */

            GridModel =  FrameworkJS.extend(function() {
                // Overwritting the properties
                this.name = 'GridModel';
                this.data = {title: "MyTitle", prop1: 'Property 1'};

            }, FrameworkJS.Model, 'Model.Grid');

            /*
            ------------------------------------
            EXTENDING THE BASE VIEW CLASS
            ------------------------------------
            */

            GridView = FrameworkJS.extend(function () {
                // Overwritting the properties
                this.name = 'GridView';
                this.domElement = '.test';

                /**
                 * Overwrite the draw function
                 */
                this.draw = function () {
                    //console.log('Overwritting the draw function...');
                };
            }, FrameworkJS.View, 'View.Grid');

            /*
            ------------------------------------
            EXTENDING THE BASE SERVICE CLASS
            ------------------------------------
            */

            GridService = FrameworkJS.extend(function() {
                // Overwriting the onSuccess function
                this.onSuccess = function(result, request) {
                    console.log('Success dude!!!', result, request, this);
                }
            }, FrameworkJS.Service, 'Service.Grid');


            /*
            ------------------------------------
            DECLARING THE FUNCTIONS THAT WILL BE
            USED ON THE EVENTS EXAMPLE
            ------------------------------------
            */

            /**
             * Triggered when the onTest event is dispatched
             * @param  {Object} event The event
             */
            onTest = function(event){
                console.log('onTest', event);
            };

            /**
             * Triggered when the onTest event is dispatched
             * @param  {Object} event The event
             */
            onTest2 = function(event){
                console.log('onTest2', event);
            };

            /*
            ------------------------------------
            INSTANTIATING INSTANCES OF THE NEW CLASSES
            ------------------------------------
            */

            gridView1 = FrameworkJS.retrieve('GRIDVIEW1', 'View.Grid');
            gridModel1 = FrameworkJS.retrieve('GRIDMODEL1', 'Model.Grid');
            gridController1 = FrameworkJS.retrieve('GRIDCONTROLLER1', 'Controller.Grid');
            gridService1 = FrameworkJS.retrieve('GRIDSERVICE1', 'Service.Grid');

            /*
            ------------------------------------
            SETTING UP A CONTROLLER AND RUNNING A CUSTOM
            FUNCTION OF THAT INSTANCE OF THE CONTROLLER
            ------------------------------------
            */

            gridController1.name = 'GridController1';
            gridController1.setView(gridView1);
            gridController1.setModel(gridModel1);
            // We execute the addListeners after we set up the model
            gridController1.addListeners();

            /*
            ------------------------------------
            WORKING WITH EVENTS
            ------------------------------------
            */

            gridController1.getView().bind('onTest', onTest, gridController1);
            gridController1.getView().bind('onTest', onTest2, gridController1);

            gridView1.trigger({type:'onTest'});

            gridController1.getView().unbind('onTest', onTest, this);
            gridController1.getView().unbind('onTest', onTest2, this);

            gridView1.trigger({type:'onTest'});

            /*
            ------------------------------------
            TESTING THE PUBLISH/SUBSCRIBE UTILITY
            ------------------------------------
            */

            gridController1.subscribe('onApplicationReady');
            FrameworkJS.Publisher.notify('onApplicationReady', {test: 'applicationReady'});
            gridController1.unsubscribe('onApplicationReady');
            FrameworkJS.Publisher.notify('onApplicationReady', {test: 'applicationReady'});

            /*
            ------------------------------------
            WORKING WITH A SERVICE
            ------------------------------------
            */

            gridService1.url = 'data.json';
            gridService1.dataType = 'json';
            gridService1.fetch();

            /*
            ------------------------------------
            CHANGING A PROPERTY OF THE MODEL
            SO THAT WE CAN CHECK IF THE CONTROLLER
            WILL SUCCESSFULLY LISTEN FOR THAT CHANGE
            ------------------------------------
            */

            gridModel1.set({prop1: 'Property 11', prop2: 'Property 2'});


        </script>
    </body>
</html>